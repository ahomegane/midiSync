(function() {

  var _sample = {
    0: ['{"0":144,"1":36,"2":127}', '{"0":128,"1":36,"2":0}', '{"0":144,"1":38,"2":127}', '{"0":128,"1":38,"2":0}', '{"0":144,"1":40,"2":127}', '{"0":128,"1":40,"2":0}', '{"0":144,"1":41,"2":127}', '{"0":128,"1":41,"2":0}', '{"0":144,"1":43,"2":127}', '{"0":128,"1":43,"2":0}', '{"0":144,"1":45,"2":127}', '{"0":128,"1":45,"2":0}', '{"0":144,"1":47,"2":127}', '{"0":128,"1":47,"2":0}'],
    1: ['{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}', '{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}', '{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}', '{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}', '{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}', '{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}', '{"0":145,"1":40,"2":127}', '{"0":129,"1":40,"2":0}'],
    3: ['{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}', '{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}', '{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}', '{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}', '{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}', '{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}', '{"0":147,"1":43,"2":127}', '{"0":131,"1":43,"2":0}'],
    4: ['{"0":148,"1":36,"2":127}', '{"0":132,"1":36,"2":0}', '{"0":148,"1":38,"2":127}', '{"0":132,"1":38,"2":0}', '{"0":148,"1":40,"2":127}', '{"0":132,"1":40,"2":0}', '{"0":148,"1":41,"2":127}', '{"0":132,"1":41,"2":0}', '{"0":148,"1":43,"2":127}', '{"0":132,"1":43,"2":0}', '{"0":148,"1":45,"2":127}', '{"0":132,"1":45,"2":0}', '{"0":148,"1":47,"2":127}', '{"0":132,"1":47,"2":0}']
  };

  var i = [0, 0, 0, 0, 0];
  var send = function(k, interval, d) {
    midiSync.socket.emit('C_to_S_message', { value: _sample[k][i[k]] });
    i[k]++;
    if (_sample[k].length > i[k]) {
      setTimeout(function() {
        send(k, interval, d);
      }, interval);
    } else {
      i[k] = 0;
      d.resolve();      
    }
    return d;
  }

  var btn = $('#demo'), isRun = false;
  btn.on('click', function() {
    if (isRun) return;
    isRun = true;
    $.when(
      send(4, 500, $.Deferred()),
      send(3, 600, $.Deferred()),
      send(1, 600, $.Deferred())      
    ).done(function() {
      isRun = false;
      midiSync.particle
        .sortCircle().rotation(1.5, 0.25, 0.5);
    });
  });

  setTimeout(function() {
    btn.css({display: 'block'});
  }, 2000);

})();